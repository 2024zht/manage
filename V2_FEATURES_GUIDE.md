# V2.0 新功能使用指南

## ✨ 新增功能总览

### 1. 排行榜快速修改积分（管理员）
- 每个成员行末有"修改积分"按钮
- 点击后弹出规则选择窗口
- 可选择现有规则或自定义积分

### 2. 批量导入功能
- 管理员面板新增"批量导入"标签
- 支持CSV格式批量导入积分
- 可下载模板文件

### 3. 管理员专用登录
- 独立的管理员登录页面 `/admin/login`
- 紫色主题，与普通登录区分
- 登录时验证管理员权限

## 🎯 功能使用说明

### 功能一：排行榜快速修改积分

#### 使用场景
管理员在查看排行榜时，发现某个学生完成了任务，需要快速加分。

#### 操作步骤

1. **以管理员身份登录**
   - 访问 `http://localhost:5173/admin/login`
   - 或使用 admin/admin123 登录

2. **进入积分看板**
   - 点击导航栏的"积分看板"或访问首页

3. **找到目标成员**
   - 在排行榜中找到要修改积分的成员
   - **注意**：只有管理员登录后才能看到"操作"列

4. **点击"修改积分"按钮**
   - 在成员行末会看到蓝色的"修改积分"按钮
   - 点击按钮打开悬浮窗

5. **选择规则或自定义积分**

   **方式A：选择现有规则**
   - 悬浮窗中显示所有规则，分为"加分规则"和"扣分规则"
   - 点击任一规则卡片（变为绿色/红色边框）
   - 例如：点击"完成实验报告 +10"

   **方式B：自定义积分**
   - 在"自定义积分"区域填写
   - 积分值：输入正数（加分）或负数（扣分）
   - 原因：填写修改原因
   - 例如：积分值 `15`，原因 `额外完成项目任务`

6. **确认修改**
   - 点击"确认修改"按钮
   - 等待提示"积分修改成功"
   - 积分立即更新，排行榜自动刷新

#### 界面说明

**悬浮窗元素**：
```
┌──────────────────────────────────┐
│ 修改积分 - 张三 (2021001)     [X]│
├──────────────────────────────────┤
│ 当前积分: 50                      │
├──────────────────────────────────┤
│ 加分规则 ✅                       │
│ ┌────────────┬────────────┐     │
│ │完成实验报告│ 参加组会   │     │
│ │    +10     │    +5      │     │
│ └────────────┴────────────┘     │
├──────────────────────────────────┤
│ 扣分规则 ❌                       │
│ ┌────────────┬────────────┐     │
│ │迟到        │未完成任务   │     │
│ │    -5      │   -10      │     │
│ └────────────┴────────────┘     │
├──────────────────────────────────┤
│ 或自定义积分                      │
│ 积分值: [     ]                  │
│ 原因:   [     ]                  │
├──────────────────────────────────┤
│ [确认修改]  [取消]               │
└──────────────────────────────────┘
```

### 功能二：批量导入积分

#### 使用场景
完成一次作业，需要为多个学生批量录入成绩积分。

#### 操作步骤

1. **进入管理员面板**
   - 以管理员身份登录
   - 点击"管理面板"

2. **切换到"批量导入"标签**
   - 在顶部标签中点击"批量导入"图标

3. **下载模板文件（可选）**
   - 点击"下载模板文件"按钮
   - 获得CSV格式的模板

4. **准备导入数据**

   **方式A：使用Excel**
   ```
   1. 打开下载的模板文件
   2. 填写学号和积分：
      学号      积分    备注
      2021001   10     完成实验报告
      2021002   15     优秀完成
      2021003   -5     迟交
   3. 复制数据（不包括表头）
   ```

   **方式B：直接编辑**
   ```
   在文本框中直接输入：
   2021001,10,完成实验报告
   2021002,15,优秀完成
   2021003,-5,迟交
   ```

5. **粘贴数据**
   - 将数据粘贴到"导入数据"文本框

6. **填写导入原因**
   - 在"导入原因"框中输入
   - 例如：`第一次实验报告成绩`

7. **开始导入**
   - 点击"开始导入"按钮
   - 查看导入结果

8. **查看结果**
   - 显示成功和失败数量
   - 如有错误，显示详细错误信息
   - 例如：
     ```
     ✅ 导入成功
     成功: 10 条
     失败: 0 条
     ```

#### CSV格式说明

**标准格式**：
```csv
学号,积分,备注
2021001,10,完成实验报告
2021002,15,参加组会并发言
2021003,-5,迟到
```

**规则**：
- 第一行可以是表头（会自动跳过）
- 每行格式：`学号,积分,备注`
- 学号必须存在于系统中
- 积分可以是正数或负数
- 备注可选（不影响导入）
- 逗号分隔，支持中英文逗号

#### 常见错误

| 错误提示 | 原因 | 解决方法 |
|---------|------|---------|
| `学号 2021999: 用户不存在` | 学号不在系统中 | 确认学号正确，或让学生先注册 |
| `学号 未知: 数据不完整` | 格式错误 | 检查每行是否有学号和积分 |
| `没有有效的导入数据` | 数据为空 | 确保已粘贴数据 |

### 功能三：管理员专用登录

#### 两种登录方式对比

| 登录方式 | URL | 主题色 | 说明 |
|---------|-----|-------|------|
| 普通登录 | `/login` | 蓝色 | 所有用户都可以登录 |
| 管理员登录 | `/admin/login` | 紫色 | 验证管理员权限 |

#### 管理员登录流程

1. **访问管理员登录页**
   ```
   http://localhost:5173/admin/login
   ```

2. **输入管理员账户**
   - 用户名：`admin`
   - 密码：`admin123`

3. **系统验证**
   - 检查用户名和密码
   - 验证是否具有管理员权限

4. **权限检查**
   - ✅ 是管理员：跳转到 `/admin` 管理面板
   - ❌ 不是管理员：显示错误"您没有管理员权限"

#### 区别说明

**普通登录** (`/login`)：
- 蓝色主题
- 所有用户都可以登录
- 登录后进入积分看板
- 普通用户看不到"修改积分"按钮

**管理员登录** (`/admin/login`)：
- 紫色主题
- 盾牌图标
- 只有管理员才能成功登录
- 登录后直接进入管理面板
- 可以看到所有管理功能

## 🎨 界面展示

### 1. 积分看板（管理员视图）

```
┌────────────────────────────────────────────────────────────┐
│ 排名 │ 姓名   │ 学号     │ 班级   │ 积分 │ 角色  │ 操作    │
├────────────────────────────────────────────────────────────┤
│  🏆  │ 张三   │ 2021001  │ 1班    │ 100  │       │[修改积分]│
│  🥈  │ 李四   │ 2021002  │ 1班    │  95  │       │[修改积分]│
│  🥉  │ 王五   │ 2021003  │ 2班    │  90  │       │[修改积分]│
│  4   │ 赵六   │ 2021004  │ 2班    │  85  │管理员 │[修改积分]│
└────────────────────────────────────────────────────────────┘
```

**注意**：普通用户看不到"操作"列

### 2. 修改积分悬浮窗

点击"修改积分"后显示的弹窗，包含：
- 当前用户信息和积分
- 加分规则列表（绿色）
- 扣分规则列表（红色）
- 自定义积分输入框
- 确认/取消按钮

### 3. 批量导入页面

管理员面板 → 批量导入标签：
- 导入说明（蓝色提示框）
- 下载模板按钮
- 数据输入框（支持粘贴）
- 原因输入框
- 开始导入按钮
- 导入结果显示

## 📝 使用技巧

### 技巧1：快速加分
在排行榜上直接点击"修改积分"，比进入管理面板再查找用户更快。

### 技巧2：批量操作
如果需要为多个学生加相同的分数，使用批量导入功能，准备CSV数据一次性导入。

### 技巧3：自定义积分
如果某个行为不在规则列表中，使用"自定义积分"功能，灵活调整积分。

### 技巧4：Excel编辑
使用Excel编辑CSV更直观，可以使用公式计算积分，然后复制粘贴到批量导入框。

### 技巧5：导入验证
批量导入前，先用少量数据测试，确认格式正确后再大批量导入。

## ⚠️ 注意事项

1. **权限要求**：
   - 修改积分和批量导入都需要管理员权限
   - 普通用户看不到这些功能

2. **数据验证**：
   - 学号必须在系统中已存在
   - 积分必须是有效的数字
   - 导入原因必须填写

3. **操作记录**：
   - 所有积分变动都会记录在日志中
   - 包括操作者、时间、原因

4. **防止误操作**：
   - 积分修改需要确认
   - 建议定期备份数据库

## 🚀 快速开始

### 第一次使用

```bash
# 1. 重启项目（应用新代码）
cd /mnt/d/robotlab/manage
npm run dev

# 2. 访问管理员登录
http://localhost:5173/admin/login

# 3. 使用默认账户
用户名: admin
密码: admin123

# 4. 体验新功能
- 点击"积分看板"，查看"修改积分"按钮
- 点击"管理面板" → "批量导入"
```

### 完整流程示例

**场景：第一次作业评分**

1. 准备数据：
   ```
   2021001,10,优秀
   2021002,8,良好
   2021003,6,及格
   ```

2. 管理员登录 → 管理面板 → 批量导入

3. 粘贴数据，填写原因："第一次实验报告"

4. 点击"开始导入"

5. 查看结果，确认成功

6. 返回积分看板，验证积分已更新

---

**版本**: 2.0.0  
**更新日期**: 2025-01-20  
**状态**: ✅ 已实现并可用

