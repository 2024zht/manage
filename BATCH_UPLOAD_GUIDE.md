# æ‰¹é‡ä¸Šä¼ ä¸åŒé˜¶æ®µè¿›åº¦åŠŸèƒ½æŒ‡å—

## ğŸ‰ æ–°åŠŸèƒ½æ¦‚è§ˆ

### âœ¨ ä¸»è¦ç‰¹æ€§

1. **æ‰¹é‡ä¸Šä¼ ** - ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶åŒæ—¶ä¸Šä¼ 
2. **ä¸Šä¼ é˜Ÿåˆ—ç®¡ç†** - å¯è§†åŒ–é˜Ÿåˆ—ï¼Œå®æ—¶æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶çŠ¶æ€
3. **åŒé˜¶æ®µè¿›åº¦æ˜¾ç¤º** - åˆ†åˆ«æ˜¾ç¤ºï¼š
   - ğŸ“¤ ä¸Šä¼ åˆ°æœåŠ¡å™¨è¿›åº¦ï¼ˆ0-70%ï¼‰
   - â˜ï¸ åŒæ­¥åˆ°äº‘ç«¯è¿›åº¦ï¼ˆ70-100%ï¼‰
4. **ç‹¬ç«‹è¿›åº¦è·Ÿè¸ª** - æ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹æ˜¾ç¤ºè¿›åº¦
5. **çŠ¶æ€å›¾æ ‡** - ç›´è§‚çš„å›¾æ ‡è¡¨ç¤ºä¸åŒçŠ¶æ€
6. **æ—¶é—´ç»Ÿè®¡** - æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„ä¸Šä¼ è€—æ—¶

---

## ğŸ“¸ UI é¢„è§ˆ

### ä¸Šä¼ é˜Ÿåˆ—æ‚¬æµ®çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¤ ä¸Šä¼ é˜Ÿåˆ— (2/5)                     [æ¸…é™¤å·²å®Œæˆ]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ• C++ Primer.pdf                                  Ã—   â”‚
â”‚  164.7 MB                                                â”‚
â”‚  ç­‰å¾…ä¸Šä¼ ...                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Pythonæ•™ç¨‹.pdf                                   Ã—   â”‚
â”‚  85.3 MB Â· ç”¨æ—¶ 2åˆ†15ç§’                                  â”‚
â”‚  ğŸ“¤ ä¸Šä¼ åˆ°æœåŠ¡å™¨... 45%                                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”              â”‚
â”‚  æ€»è¿›åº¦                                          31%     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                â”‚
â”‚  ğŸ“¡ æœåŠ¡å™¨: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 45%            â”‚
â”‚  â˜ï¸  äº‘ç«¯:   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â˜ï¸  ç®—æ³•å¯¼è®º.pdf                                    Ã—   â”‚
â”‚  125.2 MB                                                â”‚
â”‚  â˜ï¸ åŒæ­¥åˆ°äº‘ç«¯... 80%                                    â”‚
â”‚  æ€»è¿›åº¦                                          94%     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            â”‚
â”‚  ğŸ“¡ æœåŠ¡å™¨: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%         â”‚
â”‚  â˜ï¸  äº‘ç«¯:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 80%         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ æ·±åº¦å­¦ä¹ .pdf                                      Ã—   â”‚
â”‚  92.5 MB Â· ç”¨æ—¶ 1åˆ†45ç§’                                  â”‚
â”‚  âœ“ ä¸Šä¼ å®Œæˆ                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âŒ æ–‡ä»¶è¿‡å¤§.pdf                                      Ã—   â”‚
â”‚  550 MB                                                  â”‚
â”‚  æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### å‰ç«¯æ¶æ„

#### 1. ç±»å‹å®šä¹‰

```typescript
export interface UploadTask {
  id: string;                    // å”¯ä¸€æ ‡è¯†
  file: File;                    // æ–‡ä»¶å¯¹è±¡
  status: 'waiting' | 'uploading' | 'syncing' | 'completed' | 'error';
  progress: number;              // æ€»è¿›åº¦ 0-100
  serverProgress: number;        // æœåŠ¡å™¨è¿›åº¦ 0-100
  cloudProgress: number;         // äº‘ç«¯è¿›åº¦ 0-100
  error?: string;                // é”™è¯¯ä¿¡æ¯
  startTime?: number;            // å¼€å§‹æ—¶é—´
  endTime?: number;              // ç»“æŸæ—¶é—´
}
```

#### 2. çŠ¶æ€ç®¡ç†

```typescript
const [uploadTasks, setUploadTasks] = useState<UploadTask[]>([]);
const [isUploading, setIsUploading] = useState(false);
```

#### 3. ä¸Šä¼ æµç¨‹

```
é€‰æ‹©æ–‡ä»¶
  â†“
åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—
  â†“
é€ä¸ªå¤„ç†ä»»åŠ¡
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€é˜¶æ®µï¼šæœåŠ¡å™¨    â”‚
â”‚  - ä¸Šä¼ æ–‡ä»¶          â”‚
â”‚  - è¿›åº¦ï¼š0-70%       â”‚
â”‚  - å®æ—¶æ›´æ–°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬äºŒé˜¶æ®µï¼šäº‘ç«¯      â”‚
â”‚  - B2 åŒæ­¥           â”‚
â”‚  - è¿›åº¦ï¼š70-100%     â”‚
â”‚  - æ¨¡æ‹Ÿæ˜¾ç¤º          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
å®Œæˆ / é”™è¯¯
```

### åç«¯å“åº”

```typescript
// ä¸Šä¼ å“åº”
{
  message: 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸ',
  id: 123,
  filename: '1761024093732-724374146-C.pdf',
  originalName: 'C++ Primer.pdf',
  fileSize: 172593152,
  b2Synced: false,
  b2Path: null,
  syncError: null,
  needsB2Sync: false  // æ–°å¢ï¼šæŒ‡ç¤ºæ˜¯å¦éœ€è¦B2åŒæ­¥
}
```

---

## ğŸ¨ çŠ¶æ€å›¾æ ‡è¯´æ˜

| å›¾æ ‡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ğŸ• | waiting | ç­‰å¾…ä¸Šä¼  |
| ğŸ“Š | uploading | æ­£åœ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ |
| â˜ï¸ | syncing | æ­£åœ¨åŒæ­¥åˆ°äº‘ç«¯ |
| âœ“ | completed | ä¸Šä¼ å®Œæˆ |
| âŒ | error | ä¸Šä¼ å¤±è´¥ |

---

## ğŸ’¡ ä½¿ç”¨æ–¹æ³•

### 1. é€‰æ‹©å¤šä¸ªæ–‡ä»¶

```jsx
<input
  type="file"
  accept=".pdf,.epub,.mobi,.azw3,.txt,.doc,.docx"
  onChange={handleFileSelect}
  multiple  // å…³é”®ï¼šå¯ç”¨å¤šæ–‡ä»¶é€‰æ‹©
/>
```

### 2. åˆ›å»ºä¸Šä¼ ä»»åŠ¡

```typescript
const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
  const files = e.target.files;
  
  // ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºä»»åŠ¡
  const newTasks: UploadTask[] = Array.from(files).map((file) => ({
    id: `${Date.now()}-${Math.random()}`,
    file,
    status: 'waiting',
    progress: 0,
    serverProgress: 0,
    cloudProgress: 0,
    startTime: Date.now(),
  }));

  setUploadTasks((prev) => [...prev, ...newTasks]);
  
  // å¼€å§‹å¤„ç†é˜Ÿåˆ—
  processUploadQueue([...uploadTasks, ...newTasks]);
};
```

### 3. å¤„ç†ä¸Šä¼ é˜Ÿåˆ—

```typescript
const processUploadQueue = async (tasks: UploadTask[]) => {
  setIsUploading(true);

  // é¡ºåºä¸Šä¼ æ¯ä¸ªæ–‡ä»¶
  for (const task of tasks) {
    if (task.status !== 'waiting') continue;
    await uploadSingleFile(task);
  }

  setIsUploading(false);
  fetchEbooks(); // åˆ·æ–°åˆ—è¡¨
};
```

### 4. ä¸Šä¼ å•ä¸ªæ–‡ä»¶ï¼ˆåŒé˜¶æ®µï¼‰

```typescript
const uploadSingleFile = async (task: UploadTask) => {
  updateTask(task.id, { status: 'uploading' });

  const formData = new FormData();
  formData.append('file', task.file);

  try {
    // ç¬¬ä¸€é˜¶æ®µï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
    const response = await ebookAPI.upload(formData, (progressEvent) => {
      if (progressEvent.total) {
        const serverPercent = Math.round((progressEvent.loaded * 100) / progressEvent.total);
        const overallProgress = Math.round(serverPercent * 0.7); // å 70%
        
        updateTask(task.id, {
          serverProgress: serverPercent,
          progress: overallProgress,
        });
      }
    });

    // ç¬¬äºŒé˜¶æ®µï¼šåŒæ­¥åˆ°äº‘ç«¯
    if (response.data.needsB2Sync) {
      updateTask(task.id, { status: 'syncing' });
      await simulateCloudSync(task.id);
    } else {
      updateTask(task.id, {
        status: 'completed',
        progress: 100,
        endTime: Date.now(),
      });
    }

  } catch (error: any) {
    updateTask(task.id, {
      status: 'error',
      error: error.response?.data?.error || 'ä¸Šä¼ å¤±è´¥',
    });
  }
};
```

### 5. æ¨¡æ‹Ÿäº‘ç«¯åŒæ­¥è¿›åº¦

```typescript
const simulateCloudSync = async (taskId: string) => {
  return new Promise<void>((resolve) => {
    let cloudProgress = 0;
    const interval = setInterval(() => {
      cloudProgress += 10;
      const overallProgress = 70 + Math.round(cloudProgress * 0.3); // å 30%

      updateTask(taskId, {
        cloudProgress,
        progress: overallProgress,
      });

      if (cloudProgress >= 100) {
        clearInterval(interval);
        updateTask(taskId, {
          status: 'completed',
          progress: 100,
          endTime: Date.now(),
        });
        resolve();
      }
    }, 200); // æ¯200msæ›´æ–°ä¸€æ¬¡
  });
};
```

---

## ğŸ“Š è¿›åº¦è®¡ç®—è¯´æ˜

### æ€»è¿›åº¦åˆ†é…

- **æœåŠ¡å™¨é˜¶æ®µ**ï¼š0-70% ï¼ˆå æ€»è¿›åº¦çš„70%ï¼‰
- **äº‘ç«¯é˜¶æ®µ**ï¼š70-100% ï¼ˆå æ€»è¿›åº¦çš„30%ï¼‰

### è®¡ç®—å…¬å¼

```typescript
// æœåŠ¡å™¨è¿›åº¦è´¡çŒ®
const serverContribution = serverProgress * 0.7;

// äº‘ç«¯è¿›åº¦è´¡çŒ®
const cloudContribution = cloudProgress * 0.3;

// æ€»è¿›åº¦
const totalProgress = serverContribution + cloudContribution;
```

### ç¤ºä¾‹

| æœåŠ¡å™¨è¿›åº¦ | äº‘ç«¯è¿›åº¦ | æ€»è¿›åº¦ | è¯´æ˜ |
|-----------|---------|-------|------|
| 0% | 0% | 0% | å¼€å§‹ |
| 50% | 0% | 35% | ä¸Šä¼ ä¸­ |
| 100% | 0% | 70% | æœåŠ¡å™¨å®Œæˆ |
| 100% | 50% | 85% | äº‘ç«¯åŒæ­¥ä¸­ |
| 100% | 100% | 100% | å®Œæˆ |

---

## ğŸ›ï¸ é˜Ÿåˆ—ç®¡ç†åŠŸèƒ½

### 1. ç§»é™¤å•ä¸ªä»»åŠ¡

```typescript
const removeTask = (taskId: string) => {
  setUploadTasks((prev) => prev.filter((task) => task.id !== taskId));
};
```

### 2. æ¸…é™¤å·²å®Œæˆä»»åŠ¡

```typescript
const clearCompletedTasks = () => {
  setUploadTasks((prev) =>
    prev.filter((task) => 
      task.status !== 'completed' && task.status !== 'error'
    )
  );
};
```

### 3. é˜Ÿåˆ—ç»Ÿè®¡

```typescript
// æ€»ä»»åŠ¡æ•°
const totalTasks = uploadTasks.length;

// è¿›è¡Œä¸­çš„ä»»åŠ¡
const activeTasks = uploadTasks.filter(t => 
  t.status === 'uploading' || t.status === 'syncing'
).length;

// å·²å®Œæˆçš„ä»»åŠ¡
const completedTasks = uploadTasks.filter(t => 
  t.status === 'completed'
).length;
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. é¡ºåºä¸Šä¼  vs å¹¶å‘ä¸Šä¼ 

**å½“å‰å®ç°ï¼šé¡ºåºä¸Šä¼ **
```typescript
for (const task of tasks) {
  await uploadSingleFile(task); // ç­‰å¾…ä¸Šä¸€ä¸ªå®Œæˆ
}
```

**ä¼˜åŒ–æ–¹æ¡ˆï¼šå¹¶å‘ä¸Šä¼ **ï¼ˆå¯é€‰ï¼‰
```typescript
// åŒæ—¶ä¸Šä¼ 3ä¸ªæ–‡ä»¶
const CONCURRENT_UPLOADS = 3;

const uploadBatch = async (tasks: UploadTask[]) => {
  const batches = [];
  for (let i = 0; i < tasks.length; i += CONCURRENT_UPLOADS) {
    const batch = tasks.slice(i, i + CONCURRENT_UPLOADS);
    batches.push(
      Promise.all(batch.map(task => uploadSingleFile(task)))
    );
  }
  
  for (const batch of batches) {
    await batch;
  }
};
```

### 2. å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 

```typescript
// å°†æ–‡ä»¶åˆ†æˆå¤šä¸ªå—
const CHUNK_SIZE = 10 * 1024 * 1024; // 10MB

const uploadFileInChunks = async (file: File) => {
  const totalChunks = Math.ceil(file.size / CHUNK_SIZE);
  
  for (let i = 0; i < totalChunks; i++) {
    const start = i * CHUNK_SIZE;
    const end = Math.min(start + CHUNK_SIZE, file.size);
    const chunk = file.slice(start, end);
    
    await uploadChunk(chunk, i, totalChunks);
    
    // æ›´æ–°è¿›åº¦
    const progress = Math.round(((i + 1) / totalChunks) * 100);
    updateTask(taskId, { serverProgress: progress });
  }
};
```

---

## ğŸ¨ UI å®šåˆ¶

### é¢œè‰²æ–¹æ¡ˆ

```typescript
// çŠ¶æ€é¢œè‰²
const statusColors = {
  waiting: 'text-gray-400',
  uploading: 'text-blue-500',
  syncing: 'text-purple-500',
  completed: 'text-green-500',
  error: 'text-red-500',
};

// è¿›åº¦æ¡é¢œè‰²
const progressColors = {
  server: 'bg-blue-500',
  cloud: 'bg-purple-500',
  overall: 'bg-gradient-to-r from-blue-500 to-purple-500',
};
```

### åŠ¨ç”»æ•ˆæœ

```css
/* è„‰å†²åŠ¨ç”» */
.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* è¿›åº¦æ¡è¿‡æ¸¡ */
.transition-all {
  transition: all 0.3s ease-out;
}

/* æ·¡å…¥æ•ˆæœ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

### ç§»åŠ¨ç«¯é€‚é…

```typescript
// æ¡Œé¢ç«¯ï¼šå®½åº¦480px
// ç§»åŠ¨ç«¯ï¼šå…¨å±
<div className="fixed bottom-6 right-6 z-50 
                w-[480px] max-w-[90vw]
                sm:right-6 sm:w-[480px]
                ...">
```

### æ»šåŠ¨ä¼˜åŒ–

```typescript
// æœ€å¤§é«˜åº¦400pxï¼Œè¶…å‡ºæ»šåŠ¨
<div className="max-h-[400px] overflow-y-auto">
  {uploadTasks.map(task => (
    // ä»»åŠ¡å¡ç‰‡
  ))}
</div>
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### 1. å•æ–‡ä»¶ä¸Šä¼ 

- é€‰æ‹© 1 ä¸ªæ–‡ä»¶
- è§‚å¯ŸåŒé˜¶æ®µè¿›åº¦
- éªŒè¯å®ŒæˆåçŠ¶æ€

### 2. æ‰¹é‡ä¸Šä¼ ï¼ˆå°æ–‡ä»¶ï¼‰

- é€‰æ‹© 5 ä¸ªæ–‡ä»¶ï¼ˆæ¯ä¸ª <10MBï¼‰
- è§‚å¯Ÿé˜Ÿåˆ—é¡ºåºå¤„ç†
- éªŒè¯æ‰€æœ‰æ–‡ä»¶æˆåŠŸ

### 3. æ‰¹é‡ä¸Šä¼ ï¼ˆå¤§æ–‡ä»¶ï¼‰

- é€‰æ‹© 3 ä¸ªæ–‡ä»¶ï¼ˆæ¯ä¸ª >100MBï¼‰
- è§‚å¯Ÿé•¿æ—¶é—´ä¸Šä¼ çš„è¿›åº¦æ›´æ–°
- éªŒè¯äº‘ç«¯åŒæ­¥é˜¶æ®µ

### 4. é”™è¯¯å¤„ç†

- ä¸Šä¼ è¶…å¤§æ–‡ä»¶ï¼ˆ>500MBï¼‰
- éªŒè¯é”™è¯¯æç¤º
- æµ‹è¯•ç½‘ç»œä¸­æ–­æ¢å¤

### 5. é˜Ÿåˆ—ç®¡ç†

- ä¸Šä¼ è¿‡ç¨‹ä¸­ç§»é™¤ä»»åŠ¡
- æ¸…é™¤å·²å®Œæˆä»»åŠ¡
- æ··åˆçŠ¶æ€ç®¡ç†

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šè¿›åº¦æ¡ä¸æ›´æ–°

**åŸå› **ï¼š`onUploadProgress` å›è°ƒæœªè§¦å‘

**è§£å†³**ï¼š
```typescript
// ç¡®ä¿ axios é…ç½®æ­£ç¡®
api.post('/ebooks/upload', formData, {
  headers: { 'Content-Type': 'multipart/form-data' },
  onUploadProgress: (progressEvent) => {
    // ç¡®ä¿æœ‰ total å±æ€§
    if (progressEvent.total) {
      const percent = Math.round((progressEvent.loaded * 100) / progressEvent.total);
      console.log('Progress:', percent);
    }
  },
});
```

### é—®é¢˜2ï¼šäº‘ç«¯è¿›åº¦ä¸æ˜¾ç¤º

**åŸå› **ï¼šåç«¯æœªè¿”å› `needsB2Sync`

**è§£å†³**ï¼š
```typescript
// æ£€æŸ¥åç«¯å“åº”
console.log('Response:', response.data);

// ç¡®ä¿æœ‰ needsB2Sync å­—æ®µ
if (response.data.needsB2Sync) {
  await simulateCloudSync(task.id);
}
```

### é—®é¢˜3ï¼šæ‰¹é‡ä¸Šä¼ æ–‡ä»¶é¡ºåºæ··ä¹±

**åŸå› **ï¼šå¹¶å‘ä¸Šä¼ å¯¼è‡´

**è§£å†³**ï¼šä½¿ç”¨é¡ºåºä¸Šä¼ 
```typescript
// é¡ºåºå¤„ç†
for (const task of tasks) {
  await uploadSingleFile(task);
}
```

### é—®é¢˜4ï¼šä»»åŠ¡æ— æ³•åˆ é™¤

**åŸå› **ï¼šæ­£åœ¨ä¸Šä¼ çš„ä»»åŠ¡æ— æ³•ç«‹å³åˆ é™¤

**è§£å†³**ï¼šæ·»åŠ ç¡®è®¤æç¤º
```typescript
const removeTask = (taskId: string) => {
  const task = uploadTasks.find(t => t.id === taskId);
  
  if (task && task.status === 'uploading') {
    if (!confirm('æ–‡ä»¶æ­£åœ¨ä¸Šä¼ ï¼Œç¡®å®šè¦å–æ¶ˆå—ï¼Ÿ')) {
      return;
    }
  }
  
  setUploadTasks(prev => prev.filter(t => t.id !== taskId));
};
```

---

## ğŸ¯ æœªæ¥æ”¹è¿›

### 1. å®æ—¶ B2 è¿›åº¦

ä½¿ç”¨ WebSocket æˆ– SSE è·å–çœŸå®çš„ B2 ä¸Šä¼ è¿›åº¦ï¼š

```typescript
// å»ºç«‹ WebSocket è¿æ¥
const ws = new WebSocket('ws://localhost:3010/upload-progress');

ws.onmessage = (event) => {
  const { taskId, cloudProgress } = JSON.parse(event.data);
  updateTask(taskId, { cloudProgress });
};
```

### 2. æ–­ç‚¹ç»­ä¼ 

ä¿å­˜ä¸Šä¼ è¿›åº¦ï¼Œæ”¯æŒä¸­æ–­åç»§ç»­ï¼š

```typescript
// ä¿å­˜è¿›åº¦åˆ° localStorage
localStorage.setItem(`upload_${taskId}`, JSON.stringify({
  chunks: completedChunks,
  progress: currentProgress,
}));

// æ¢å¤ä¸Šä¼ 
const savedProgress = localStorage.getItem(`upload_${taskId}`);
if (savedProgress) {
  const { chunks, progress } = JSON.parse(savedProgress);
  resumeUpload(chunks, progress);
}
```

### 3. æ‹–æ‹½ä¸Šä¼ 

```typescript
const handleDrop = (e: React.DragEvent) => {
  e.preventDefault();
  const files = Array.from(e.dataTransfer.files);
  handleFileSelect({ target: { files } } as any);
};

<div
  onDrop={handleDrop}
  onDragOver={(e) => e.preventDefault()}
  className="border-2 border-dashed border-gray-300 rounded-lg p-8"
>
  æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ 
</div>
```

### 4. ä¸Šä¼ å†å²

```typescript
interface UploadHistory {
  id: string;
  filename: string;
  fileSize: number;
  uploadedAt: string;
  duration: number;
  status: 'success' | 'failed';
}

// ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
const saveHistory = (task: UploadTask) => {
  const history = JSON.parse(localStorage.getItem('uploadHistory') || '[]');
  history.push({
    id: task.id,
    filename: task.file.name,
    fileSize: task.file.size,
    uploadedAt: new Date().toISOString(),
    duration: task.endTime! - task.startTime!,
    status: task.status === 'completed' ? 'success' : 'failed',
  });
  localStorage.setItem('uploadHistory', JSON.stringify(history));
};
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Axios Progress](https://axios-http.com/docs/req_config)
- [File API](https://developer.mozilla.org/en-US/docs/Web/API/File)
- [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData)
- [React Hooks](https://reactjs.org/docs/hooks-reference.html)

---

**ç‰ˆæœ¬**: 3.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-21  
**ä½œè€…**: å®éªŒå®¤ç®¡ç†ç³»ç»Ÿå›¢é˜Ÿ

