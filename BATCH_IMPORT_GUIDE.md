# 批量导入功能使用指南

## 🎯 功能概述

批量导入功能允许管理员通过CSV文件或手动输入的方式，一次性为多个学生修改积分。

## ✨ 主要特性

- ✅ **支持文件上传**：直接上传CSV文件，自动读取内容
- ✅ **支持手动输入**：也可以直接粘贴或输入数据
- ✅ **实时预览**：上传文件后立即显示内容
- ✅ **智能清空**：导入成功后自动清空输入区域
- ✅ **成功提示**：美观的悬浮窗显示导入结果
- ✅ **自动关闭**：3秒后自动关闭成功提示
- ✅ **错误处理**：导入失败时保留数据，方便修改重试

## 📖 使用步骤

### 方式一：上传CSV文件（推荐）⭐

#### 1. 准备CSV文件

使用Excel或记事本创建CSV文件，格式如下：

```csv
学号,积分,备注
2021001,10,完成实验报告
2021002,15,参加组会并发言
2021003,-5,迟到
2021004,8,良好完成
```

**格式要求**：
- 第一行是表头（可选，会自动跳过）
- 每行格式：`学号,积分,备注`
- 学号和积分是必填的
- 备注是可选的
- 使用逗号分隔（中英文都可以）

#### 2. 访问批量导入页面

```
管理员登录 → 管理面板 → 批量导入标签
```

#### 3. 上传文件

1. 点击"**选择CSV文件**"按钮
2. 选择准备好的CSV文件
3. 文件内容会自动显示在文本框中
4. 可以看到已选择的文件名（如：📄 成绩.csv）

#### 4. 填写导入原因

在"导入原因"输入框中填写，例如：
- `第一次实验报告成绩`
- `周三组会考勤`
- `项目完成情况`

#### 5. 点击"开始导入"

- 点击绿色的"开始导入"按钮
- 等待处理

#### 6. 查看结果

**成功时**：
```
┌─────────────────────┐
│    ✓ 导入成功！      │
│                     │
│  成功导入 10 条记录  │
│                     │
│     [  确定  ]      │
└─────────────────────┘
```

- 显示美观的成功悬浮窗
- 自动清空文件和输入框
- 3秒后自动关闭（也可点击"确定"关闭）
- 积分数据已更新

**部分失败时**：
```
成功: 8 条
失败: 2 条

错误详情:
• 学号 2021999: 用户不存在
• 学号 2021888: 用户不存在
```

**完全失败时**：
- 弹出提示："导入失败，请检查数据格式"
- **保留**输入数据，方便您修改后重试

### 方式二：手动输入

#### 1. 下载模板（可选）

点击"下载模板文件"获取示例格式

#### 2. 直接在文本框中输入

```
2021001,10,完成实验报告
2021002,15,参加组会并发言
2021003,-5,迟到
```

#### 3. 填写原因并导入

与文件上传方式相同

## 🎨 界面演示

### 批量导入页面布局

```
┌──────────────────────────────────────────────────┐
│ 📋 导入说明                                       │
│ • 支持CSV格式：学号,积分,备注                     │
│ • 积分可以是正数（加分）或负数（扣分）             │
│ • 学号必须在系统中已存在                          │
│ [下载模板文件]                                    │
├──────────────────────────────────────────────────┤
│ 上传CSV文件或手动输入                             │
│ [选择CSV文件]  📄 成绩.csv [x]                    │
│ ┌──────────────────────────────────────────────┐ │
│ │ 2021001,10,完成实验报告                      │ │
│ │ 2021002,15,参加组会并发言                    │ │
│ │ 2021003,-5,迟到                              │ │
│ └──────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────┤
│ 导入原因（必填）                                  │
│ [第一次实验报告成绩_________________________]    │
├──────────────────────────────────────────────────┤
│              [开始导入]                          │
├──────────────────────────────────────────────────┤
│ 💡 使用提示                                      │
│ 1. 点击"下载模板文件"获取CSV模板                 │
│ 2. 使用Excel或记事本编辑模板，填入数据           │
│ 3. 上传文件或复制数据粘贴到文本框                │
│ 4. 填写导入原因                                  │
│ 5. 点击"开始导入"执行批量操作                    │
└──────────────────────────────────────────────────┘
```

### 成功提示悬浮窗

```
       背景半透明遮罩
┌────────────────────────┐
│         ✓              │  绿色对勾图标
│                        │
│     导入成功！          │  大标题
│                        │
│  成功导入 10 条记录     │  统计信息
│                        │
│      [  确定  ]        │  确认按钮
└────────────────────────┘
      (3秒后自动关闭)
```

## 📝 详细功能说明

### 1. 文件选择

- 点击"选择CSV文件"打开文件选择对话框
- 支持 `.csv` 和 `.txt` 格式
- 选择后自动读取文件内容（UTF-8编码）
- 显示文件名：📄 文件名.csv
- 可以点击 ❌ 删除已选文件

### 2. 内容显示

- 文件内容自动填充到文本框
- 等宽字体显示，便于查看格式
- 可以手动编辑上传的内容
- 支持直接粘贴或手动输入

### 3. 导入处理

**数据验证**：
- 跳过空行
- 自动跳过表头（以"学号"开头的行）
- 验证每行至少包含学号和积分
- 检查学号是否存在于系统中

**导入逻辑**：
- 按行解析CSV数据
- 每个学号对应一条积分变更记录
- 正数表示加分，负数表示扣分
- 所有变更使用同一个导入原因

### 4. 结果反馈

**成功导入**（至少有1条成功）：
- ✅ 显示美观的成功悬浮窗
- 📊 显示成功和失败统计
- 🧹 自动清空所有输入（文件、文本、原因）
- 🔄 刷新用户列表
- ⏱️ 3秒后自动关闭提示窗

**完全失败**：
- ❌ 弹出错误提示
- 📝 保留输入数据
- 💡 方便修改后重试

**部分成功**：
- ⚠️ 显示警告样式
- 📋 列出所有错误详情
- 🧹 仍然清空输入（因为有成功的）

## 💡 使用技巧

### 技巧1：Excel编辑

1. 用Excel打开CSV文件
2. 第一列：学号
3. 第二列：积分
4. 第三列：备注（可选）
5. 保存为CSV格式

### 技巧2：批量计算

在Excel中可以使用公式计算积分：
```
A列: 学号
B列: =IF(C1>90, 10, IF(C1>60, 5, 0))
C列: 原始分数
```

### 技巧3：导出再导入

可以从其他系统导出学生信息，调整格式后直接导入

### 技巧4：分批导入

如果数据很多，建议分批导入：
- 每批50-100条
- 更容易发现错误
- 方便撤销操作

### 技巧5：保留备份

导入前保存一份原始CSV文件，以备查验

## ⚠️ 注意事项

### 1. 文件格式

- ✅ 推荐使用UTF-8编码
- ✅ CSV文件用逗号分隔
- ❌ 不支持Excel的`.xlsx`格式（需另存为CSV）
- ❌ 不支持Tab分隔的TSV格式

### 2. 数据要求

- 学号必须已在系统中存在
- 积分必须是整数
- 导入原因必填且不能为空

### 3. 权限限制

- 仅管理员可使用批量导入功能
- 普通用户看不到此功能

### 4. 操作记录

- 所有积分变更都会记录
- 包括：操作者、时间、原因
- 用户可在"积分历史"中查看

### 5. 数据安全

- 建议定期备份数据库
- 重要操作前先测试小批量数据
- 导入后及时验证结果

## 🔧 故障排查

### 问题1：文件上传后没有内容

**原因**：文件编码可能不是UTF-8

**解决**：
1. 用记事本打开CSV文件
2. 另存为，选择UTF-8编码
3. 重新上传

### 问题2：所有记录都失败

**原因**：可能是学号格式不对或不存在

**检查**：
1. 确认学号在系统中已注册
2. 检查是否有多余空格
3. 确认逗号分隔符正确

### 问题3：部分记录失败

**原因**：某些学号不存在

**解决**：
1. 查看错误详情
2. 让对应学生先注册
3. 或删除这些行后重新导入

### 问题4：导入后积分未更新

**原因**：可能是缓存问题

**解决**：
1. 刷新页面（F5）
2. 或重新登录

### 问题5：悬浮窗不关闭

**解决**：
- 点击"确定"按钮手动关闭
- 或等待3秒自动关闭
- 或刷新页面

## 📊 示例场景

### 场景1：期末考试成绩

**CSV文件（exam_scores.csv）**：
```csv
学号,积分,备注
2021001,20,优秀
2021002,15,良好
2021003,10,及格
2021004,20,优秀
2021005,5,不及格
```

**导入原因**：`期末考试成绩`

**结果**：
- 成功导入5条记录
- 所有学生积分已更新

### 场景2：组会考勤

**手动输入**：
```
2021001,5,按时参加
2021002,5,按时参加
2021003,-5,缺席
2021004,3,迟到
```

**导入原因**：`12月第一周组会考勤`

**结果**：
- 2021001: +5分
- 2021002: +5分
- 2021003: -5分（扣分）
- 2021004: +3分

### 场景3：项目奖励

**CSV文件**：
```csv
学号,积分,备注
2021001,50,完成大创项目
2021002,50,完成大创项目
2021003,30,参与项目
```

**导入原因**：`大创项目完成奖励`

### 场景4：违规扣分

**手动输入**：
```
2021005,-10,实验室卫生不合格
2021006,-5,未按时提交周报
```

**导入原因**：`12月违规记录`

## 🎯 最佳实践

1. **使用模板**
   - 先下载模板
   - 按模板格式填写数据

2. **小批量测试**
   - 先导入1-2条测试
   - 确认无误后批量导入

3. **及时验证**
   - 导入后立即查看排行榜
   - 确认积分变更正确

4. **保留记录**
   - 保存导入的CSV文件
   - 作为积分变更凭证

5. **定期备份**
   - 大批量导入前备份数据库
   - 便于出错后恢复

## 🆚 对比：手动修改 vs 批量导入

| 特性 | 排行榜手动修改 | 批量导入 |
|------|--------------|---------|
| 适用场景 | 单个学生 | 多个学生 |
| 操作速度 | 较慢 | 快速 |
| 规则选择 | 可选现有规则 | 统一原因 |
| 数据准备 | 不需要 | 需要CSV |
| 错误处理 | 即时反馈 | 批量反馈 |
| 推荐指数 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

**建议**：
- 1-3个学生：使用排行榜快速修改
- 3个以上：使用批量导入

---

## 📚 相关文档

- [V2_FEATURES_GUIDE.md](V2_FEATURES_GUIDE.md) - V2.0功能总览
- [USER_GUIDE.md](USER_GUIDE.md) - 用户完整手册
- [QUICKSTART.md](QUICKSTART.md) - 快速开始指南

---

**版本**: 2.1.0  
**更新日期**: 2025-01-20  
**状态**: ✅ 已实现文件上传功能

