# 快速测试邮件功能

## 方法一：测试立即点名（最快）

1. **打开浏览器**：http://你的服务器地址
2. **管理员登录**：admin / admin123
3. **点击导航栏：管理面板**
4. **点击标签页：点名管理**（在页面顶部）
5. **找到任意点名任务卡片**
6. **点击绿色按钮"立即点名"**
7. **确认**
8. **立即查看后台日志**，应该看到：
   ```
   [Trigger] Immediate trigger at: HH:MM:SS
   [Trigger] Created trigger record with ID: XX
   Attempting to send email to ...
   ✅ Email sent successfully to ...
   ```

## 方法二：测试异议申请

### 步骤1：用户提交异议（管理员收邮件）

1. **用普通用户登录**（如果没有，先注册一个）
2. **点击导航栏：积分看板**（第一个菜单）
3. **找到你自己的姓名行**
4. **点击积分数字**（会弹出窗口）
5. **点击窗口底部橙色按钮"提交异议"**
6. 填写：
   - 申请调整积分：10
   - 异议理由：测试邮件发送
7. **提交**
8. **查看后台日志**，应该看到：
   ```
   Attempting to send email to ...
   ✅ Email sent successfully to ...
   Point request submit notification sent to X admin(s)
   ```
9. **管理员邮箱应该收到通知**

### 步骤2：管理员处理异议（用户收邮件）

1. **管理员登录**
2. **点击导航栏：管理面板**
3. **点击标签页：异议管理**
4. **找到刚才提交的异议**
5. **点击"批准"或"拒绝"**
6. 填写备注（可选）
7. **确认**
8. **查看后台日志**，应该看到：
   ```
   Attempting to send email to ...
   ✅ Email sent successfully to ...
   Point request notification sent to ...
   ```
9. **用户邮箱应该收到通知**

## 方法三：测试定时点名

1. **管理员登录 → 管理面板 → 点名管理**
2. **点击紫色按钮"定时点名"**
3. **设置时间**：当前时间 + 2分钟
   - 例如：现在15:30，设置为15:32
4. **确认设置**
5. **等待2-3分钟**
6. **查看后台日志**，应该看到：
   ```
   [Scheduler] Checking notifications at 15:32:XX on 2024-XX-XX
   [Scheduler] Found 1 trigger(s) to notify
   Attempting to send email to ...
   ✅ Email sent successfully to ...
   Attendance notification sent for: ...
   ```

## 如果还是没有日志输出

### 执行以下命令检查：

```bash
# 1. 查看后台是否在运行
ps aux | grep node

# 2. 查看环境变量是否加载
cd backend
node -e "require('dotenv').config(); console.log('EMAIL_USER:', process.env.EMAIL_USER); console.log('EMAIL_PASS:', process.env.EMAIL_PASS ? '已设置' : '未设置');"

# 3. 测试邮件配置
node test-email.js

# 4. 重启服务（PM2方式）
pm2 restart all
pm2 logs

# 或者（手动方式）
# 先停止当前运行的Node进程
pkill -f "node.*server"
# 重新启动
cd backend
npm run dev
# 或
npm start
```

## 确认邮件发送的标志

当你执行操作时，后台日志应该出现以下内容：

### ✅ 正确的日志（邮件已发送）：
```
Attempting to send email to user@example.com
Email config - USER: SET, PASS: SET
Sending email with subject: 【积分异议提醒】...
✅ Email sent successfully to user@example.com
```

### ❌ 错误的日志（配置问题）：
```
Attempting to send email to user@example.com
Email config - USER: NOT SET, PASS: NOT SET
⚠️ Email configuration not found in environment variables
```

### ❌ 错误的日志（发送失败）：
```
Attempting to send email to user@example.com
Email config - USER: SET, PASS: SET
❌ Email sending failed: Error: ...
```

## 前端是否更新的检查

刷新浏览器后，在点名管理页面，每个点名任务卡片应该有：

- ✅ 绿色的"⚡ 立即点名"按钮
- ✅ 紫色的"🕐 定时点名"按钮
- ✅ 蓝色的"✏️ 编辑"按钮
- ✅ 红色的"🗑️ 删除"按钮

如果看不到前两个按钮，说明前端没有更新，需要：
```bash
cd frontend
npm run build
# 然后刷新浏览器 Ctrl+F5
```

