# å¿«é€Ÿæµ‹è¯•é‚®ä»¶åŠŸèƒ½

## æ–¹æ³•ä¸€ï¼šæµ‹è¯•ç«‹å³ç‚¹åï¼ˆæœ€å¿«ï¼‰

1. **æ‰“å¼€æµè§ˆå™¨**ï¼šhttp://ä½ çš„æœåŠ¡å™¨åœ°å€
2. **ç®¡ç†å‘˜ç™»å½•**ï¼šadmin / admin123
3. **ç‚¹å‡»å¯¼èˆªæ ï¼šç®¡ç†é¢æ¿**
4. **ç‚¹å‡»æ ‡ç­¾é¡µï¼šç‚¹åç®¡ç†**ï¼ˆåœ¨é¡µé¢é¡¶éƒ¨ï¼‰
5. **æ‰¾åˆ°ä»»æ„ç‚¹åä»»åŠ¡å¡ç‰‡**
6. **ç‚¹å‡»ç»¿è‰²æŒ‰é’®"ç«‹å³ç‚¹å"**
7. **ç¡®è®¤**
8. **ç«‹å³æŸ¥çœ‹åå°æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   [Trigger] Immediate trigger at: HH:MM:SS
   [Trigger] Created trigger record with ID: XX
   Attempting to send email to ...
   âœ… Email sent successfully to ...
   ```

## æ–¹æ³•äºŒï¼šæµ‹è¯•å¼‚è®®ç”³è¯·

### æ­¥éª¤1ï¼šç”¨æˆ·æäº¤å¼‚è®®ï¼ˆç®¡ç†å‘˜æ”¶é‚®ä»¶ï¼‰

1. **ç”¨æ™®é€šç”¨æˆ·ç™»å½•**ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªï¼‰
2. **ç‚¹å‡»å¯¼èˆªæ ï¼šç§¯åˆ†çœ‹æ¿**ï¼ˆç¬¬ä¸€ä¸ªèœå•ï¼‰
3. **æ‰¾åˆ°ä½ è‡ªå·±çš„å§“åè¡Œ**
4. **ç‚¹å‡»ç§¯åˆ†æ•°å­—**ï¼ˆä¼šå¼¹å‡ºçª—å£ï¼‰
5. **ç‚¹å‡»çª—å£åº•éƒ¨æ©™è‰²æŒ‰é’®"æäº¤å¼‚è®®"**
6. å¡«å†™ï¼š
   - ç”³è¯·è°ƒæ•´ç§¯åˆ†ï¼š10
   - å¼‚è®®ç†ç”±ï¼šæµ‹è¯•é‚®ä»¶å‘é€
7. **æäº¤**
8. **æŸ¥çœ‹åå°æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   Attempting to send email to ...
   âœ… Email sent successfully to ...
   Point request submit notification sent to X admin(s)
   ```
9. **ç®¡ç†å‘˜é‚®ç®±åº”è¯¥æ”¶åˆ°é€šçŸ¥**

### æ­¥éª¤2ï¼šç®¡ç†å‘˜å¤„ç†å¼‚è®®ï¼ˆç”¨æˆ·æ”¶é‚®ä»¶ï¼‰

1. **ç®¡ç†å‘˜ç™»å½•**
2. **ç‚¹å‡»å¯¼èˆªæ ï¼šç®¡ç†é¢æ¿**
3. **ç‚¹å‡»æ ‡ç­¾é¡µï¼šå¼‚è®®ç®¡ç†**
4. **æ‰¾åˆ°åˆšæ‰æäº¤çš„å¼‚è®®**
5. **ç‚¹å‡»"æ‰¹å‡†"æˆ–"æ‹’ç»"**
6. å¡«å†™å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
7. **ç¡®è®¤**
8. **æŸ¥çœ‹åå°æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   Attempting to send email to ...
   âœ… Email sent successfully to ...
   Point request notification sent to ...
   ```
9. **ç”¨æˆ·é‚®ç®±åº”è¯¥æ”¶åˆ°é€šçŸ¥**

## æ–¹æ³•ä¸‰ï¼šæµ‹è¯•å®šæ—¶ç‚¹å

1. **ç®¡ç†å‘˜ç™»å½• â†’ ç®¡ç†é¢æ¿ â†’ ç‚¹åç®¡ç†**
2. **ç‚¹å‡»ç´«è‰²æŒ‰é’®"å®šæ—¶ç‚¹å"**
3. **è®¾ç½®æ—¶é—´**ï¼šå½“å‰æ—¶é—´ + 2åˆ†é’Ÿ
   - ä¾‹å¦‚ï¼šç°åœ¨15:30ï¼Œè®¾ç½®ä¸º15:32
4. **ç¡®è®¤è®¾ç½®**
5. **ç­‰å¾…2-3åˆ†é’Ÿ**
6. **æŸ¥çœ‹åå°æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   [Scheduler] Checking notifications at 15:32:XX on 2024-XX-XX
   [Scheduler] Found 1 trigger(s) to notify
   Attempting to send email to ...
   âœ… Email sent successfully to ...
   Attendance notification sent for: ...
   ```

## å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ—¥å¿—è¾“å‡º

### æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ï¼š

```bash
# 1. æŸ¥çœ‹åå°æ˜¯å¦åœ¨è¿è¡Œ
ps aux | grep node

# 2. æŸ¥çœ‹ç¯å¢ƒå˜é‡æ˜¯å¦åŠ è½½
cd backend
node -e "require('dotenv').config(); console.log('EMAIL_USER:', process.env.EMAIL_USER); console.log('EMAIL_PASS:', process.env.EMAIL_PASS ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®');"

# 3. æµ‹è¯•é‚®ä»¶é…ç½®
node test-email.js

# 4. é‡å¯æœåŠ¡ï¼ˆPM2æ–¹å¼ï¼‰
pm2 restart all
pm2 logs

# æˆ–è€…ï¼ˆæ‰‹åŠ¨æ–¹å¼ï¼‰
# å…ˆåœæ­¢å½“å‰è¿è¡Œçš„Nodeè¿›ç¨‹
pkill -f "node.*server"
# é‡æ–°å¯åŠ¨
cd backend
npm run dev
# æˆ–
npm start
```

## ç¡®è®¤é‚®ä»¶å‘é€çš„æ ‡å¿—

å½“ä½ æ‰§è¡Œæ“ä½œæ—¶ï¼Œåå°æ—¥å¿—åº”è¯¥å‡ºç°ä»¥ä¸‹å†…å®¹ï¼š

### âœ… æ­£ç¡®çš„æ—¥å¿—ï¼ˆé‚®ä»¶å·²å‘é€ï¼‰ï¼š
```
Attempting to send email to user@example.com
Email config - USER: SET, PASS: SET
Sending email with subject: ã€ç§¯åˆ†å¼‚è®®æé†’ã€‘...
âœ… Email sent successfully to user@example.com
```

### âŒ é”™è¯¯çš„æ—¥å¿—ï¼ˆé…ç½®é—®é¢˜ï¼‰ï¼š
```
Attempting to send email to user@example.com
Email config - USER: NOT SET, PASS: NOT SET
âš ï¸ Email configuration not found in environment variables
```

### âŒ é”™è¯¯çš„æ—¥å¿—ï¼ˆå‘é€å¤±è´¥ï¼‰ï¼š
```
Attempting to send email to user@example.com
Email config - USER: SET, PASS: SET
âŒ Email sending failed: Error: ...
```

## å‰ç«¯æ˜¯å¦æ›´æ–°çš„æ£€æŸ¥

åˆ·æ–°æµè§ˆå™¨åï¼Œåœ¨ç‚¹åç®¡ç†é¡µé¢ï¼Œæ¯ä¸ªç‚¹åä»»åŠ¡å¡ç‰‡åº”è¯¥æœ‰ï¼š

- âœ… ç»¿è‰²çš„"âš¡ ç«‹å³ç‚¹å"æŒ‰é’®
- âœ… ç´«è‰²çš„"ğŸ• å®šæ—¶ç‚¹å"æŒ‰é’®
- âœ… è“è‰²çš„"âœï¸ ç¼–è¾‘"æŒ‰é’®
- âœ… çº¢è‰²çš„"ğŸ—‘ï¸ åˆ é™¤"æŒ‰é’®

å¦‚æœçœ‹ä¸åˆ°å‰ä¸¤ä¸ªæŒ‰é’®ï¼Œè¯´æ˜å‰ç«¯æ²¡æœ‰æ›´æ–°ï¼Œéœ€è¦ï¼š
```bash
cd frontend
npm run build
# ç„¶ååˆ·æ–°æµè§ˆå™¨ Ctrl+F5
```

